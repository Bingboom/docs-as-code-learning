阶段 1：环境准备

安装并导入必要的库：

!pip install python-docx pandas pyyaml


核心库：

python-docx：读取 Word 文档内容

pandas：生成 CSV 中间格式

pyyaml：生成 YAML 格式

阶段 2：文档预处理

目标：提取干净的文本，去掉空行/多余空格。

from docx import Document

def extract_text(doc_path):
    """提取 Word 文档中的纯净文本"""
    doc = Document(doc_path)
    lines = [p.text.strip() for p in doc.paragraphs if p.text.strip()]
    return "\n".join(lines)

doc_content = extract_text("AT_Commands.docx")
print(doc_content[:500])  # 预览前500字符

阶段 3：规则解析

定义关键模式：

命令标题：AT+XXXX 或 ATI

命令格式：关键字 "命令格式"

参数：关键字 "参数"

示例：关键字 "示例"

import re

COMMAND_PATTERN = r'^(AT[\+\w]+)[:：]\s*(.*)'  # 命令 + 描述
PARAM_PATTERN = r'<([^>]+)>\s*(.*)'            # 参数


解析函数：

def parse_commands(text):
    """从文档内容中提取 AT 命令结构化信息"""
    lines = text.splitlines()
    commands, current = [], None
    section = None

    for line in lines:
        # 检测命令开始
        cmd_match = re.match(COMMAND_PATTERN, line)
        if cmd_match:
            if current:
                commands.append(current)
            current = {
                "command": cmd_match.group(1),
                "description": cmd_match.group(2).strip(),
                "format": "",
                "parameters": [],
                "examples": []
            }
            section = None
            continue

        if not current:
            continue

        # 检测小节
        if line.startswith("命令格式"):
            section = "format"
            continue
        elif line.startswith("参数"):
            section = "parameters"
            continue
        elif line.startswith("示例"):
            section = "examples"
            continue

        # 收集内容
        if section == "format":
            current["format"] += line + " "
        elif section == "parameters":
            param_match = re.match(PARAM_PATTERN, line)
            if param_match:
                current["parameters"].append({
                    "name": param_match.group(1),
                    "desc": param_match.group(2)
                })
        elif section == "examples":
            current["examples"].append(line)

    if current:
        commands.append(current)
    return commands

阶段 4：清理与增强

保证每个命令都有 format、parameters、examples

补充一些通用参数/示例（通过模式库）

def clean_commands(commands):
    for cmd in commands:
        cmd["format"] = cmd["format"].strip()
        cmd["examples"] = [ex.strip() for ex in cmd["examples"] if ex.strip()]
    return commands

阶段 5：导出数据

导出 CSV

import pandas as pd

def export_csv(commands, path="at_commands.csv"):
    rows = []
    for cmd in commands:
        rows.append({
            "command": cmd["command"],
            "description": cmd["description"],
            "format": cmd["format"],
            "parameters": "; ".join([f"{p['name']}:{p['desc']}" for p in cmd["parameters"]]),
            "examples": "; ".join(cmd["examples"])
        })
    df = pd.DataFrame(rows)
    df.to_csv(path, index=False, encoding="utf-8-sig")
    return df


导出 YAML

import yaml

def export_yaml(commands, path="at_commands.yaml"):
    with open(path, "w", encoding="utf-8") as f:
        yaml.dump({"at_commands": commands}, f, allow_unicode=True, sort_keys=False)

阶段 6：验证与修正

检查是否有缺失的 description

检查重复命令

提供手动修正入口

def validate(commands):
    issues = []
    seen = set()
    for cmd in commands:
        if not cmd["description"]:
            issues.append(f"{cmd['command']} 缺少描述")
        if cmd["command"] in seen:
            issues.append(f"{cmd['command']} 出现重复")
        seen.add(cmd["command"])
    return issues

✅ 最终流程
doc_content = extract_text("AT_Commands.docx")
commands = parse_commands(doc_content)
commands = clean_commands(commands)

# 导出
df = export_csv(commands, "at_commands.csv")
export_yaml(commands, "at_commands.yaml")

# 验证
issues = validate(commands)
print("发现问题:", issues)